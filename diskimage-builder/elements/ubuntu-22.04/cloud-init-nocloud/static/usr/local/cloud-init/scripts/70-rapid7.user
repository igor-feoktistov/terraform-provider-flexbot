#!/bin/bash -x

rapid7User="rapid7-scan"

adduser --home /home/$rapid7User --gecos "Rapid7 Scans" --disabled-password --shell /bin/bash $rapid7User
mkdir -p /home/$rapid7User/.ssh
chmod 755 /home/$rapid7User/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7cdO8N3Qe/4JuPiccl1ssbE17TxOSgRYgRXuJDnalbsFV3mUl8pPCJRm34pLtRMOx+On+RqumiSvK9Lq/ODiv3Ou4NqQ2K5mN/6b8OyPSs+H3VPw7FQto8HlIUCo9lho8KSrudIOyDxf9XG2ztdQ+vG70vECOudJVH4YoLBIpWqxOEcMid2m4WYCA4pe8Wqzlb511RDRMG/tmvpw8gSP3ErCHEA+MCjaJfvgpa0uY26ADxQp95cyn6/i4O9Pr8KB1/yA9i7N2McNOHAChB6NmDxmiBilFpViHsBs6ennAKN7/oRMrGaOBwAYEfbLRb6xrGQT+vkwpZnCduvqPPSCr vm_scanning_linux" > /home/$rapid7User/.ssh/authorized_keys
chmod 600 /home/$rapid7User/.ssh/authorized_keys
chown -R $rapid7User /home/$rapid7User

# setup sudoers
echo "$rapid7User ALL = (ALL) NOPASSWD: ALL" > /etc/sudoers.d/$rapid7User
chmod 440 /etc/sudoers.d/$rapid7User
